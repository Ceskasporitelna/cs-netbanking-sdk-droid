# NetbankingSDK Usage Guide

Netbanking SDK allows you to get information about user's profile, accounts, cards and payment orders from Česká spořitelna a.s.

## Before You Begin

### Configuration

Before using CSAS SDKs in your application, you need to initialize it by providing it your WebApiKey.

```java
    // Set your WebApi key
    CoreSDK.getInstance().useWebApiKey( "YourApiKey" )

    // Initialize netbanking
    // Only if you haven't set up WebApiConfiguration for CoreSDK
    Netbanking.getInstance().init(WebApiConfiguration);

    //Obtain your NetbankingClient
    NetbankingClient client = Netbanking.getInstance().getNetbankingClient();

```

**See [configuration guide](./configuration.md)** for all the available configuration options.


### Authentication
Before making any calls through Netbanking SDK, you need to obtain an valid access token for the user of your application.

#### With Locker (preffered method)

Locker is CoreSDK tool which simplifies authentication against CSAS servers. Make sure to go through CoreSDK and Locker configuration settings (see above) in a case of using this authentication method. 

This should be defined in your code after going through [configuration guide](./configuration.md).

```java

    // Locker configuration 
    LockerConfig lockerConfig = new LockerConfig.Builder()
        .setClientId("YourClientID")
        .setClientSecret("YourClientSecret")
        .setPublicKey("YourPublicKey")
        .setRedirectUrl("yourscheme://your-host")
        .setScope("/v1/netbanking")
        .setOfflineAuthEnabled()
        .create();

    // CoreSDK configuration
    CoreSDK.getInstance()
        .useContext(Context)
        .useWebApiKey("YourApiKey")
        .useEnvironment(Environment.Sandbox)
        .useLanguage("en-US")
        .useRequestSigning("YourPrivateSigningKey")
        /**
         * IMPORTANT!
         *
         * Let CoreSDK know that you use Locker and pass configuration object.
         */
        .useLocker(lockerConfig)

```

When the locker is in **unlocked** state, the access token will be automatically passed to the Netbanking SDK. Refresh of the token will also be done automatically for you.

#### Without Locker

Locker is not the only option how to handle the authentication process. It is possible to pass your own access token provider. See the code snippet below.

```java

    // Get Netbanking client
    NetbankingClient client = Netbanking.getInstance().getNetbankingClient();
    
    // Set access token provider
    client.setAccessTokenProvider(new AccessTokenProvider() {
        @Override
        public void getAccessToken(CallbackWebApi<AccessToken> callback) {
            // implement your retrieving access token
        }

        @Override
        public void refreshAccessToken(CallbackWebApi<AccessToken> callback) {
            // implement your refreshing access token
        }
    });
```

## Functionality

Netbanking SDK provides the following functionality:


- [**Accounts**](./accounts.md) - List all of user's accounts, get detail of an individual account and additional information about it.
- [**AuthorizationLimits**](./authorizationLimits.md) - Return payment limits for all authorization methods and channels.
- [**AuthorizationToken**](./authorizationToken.md) - Invalidate user's token.
- [**Budgets**](./budgets.md) - List watched categories of transactions and create new ones.
- [**Bundles**](./bundles.md) - Combine multiple payment orders into a bundle that can be signed at once.
- [**Cards**](./cards.md) - List all of user's cards, get detail of an individual card and additional information about it.
- [**Contacts**](./contacts.md) - List user's contact infomation (addresses, phone nubers, e-mails).
- [**Contracts**](./contracts.md) - List and manipulate with contracts of the user. These include:
    - savings,
    - insurances,
    - pensions,
    - iBod program.
- [**Goals**](./goals.md) - List & change saving goals (currently one only) of current user.
- [**Messages**](./messages.md) - Get & manage all messages for current user generated by bank itself.
- [**Orders**](./orders.md) -  Get list of payment orders for accounts for the current user, create domestic payment orders and get infomation about user's limits.
- [**Securities**](./securities.md) - List securities accounts for current user. Securities account represents virtual account which holds securities titles and its shares (funds, bonds, etc.). Change settings or make notes about transactions.
- [**Services**](./services.md) - List services for current user.
- [**Settings**](./settings.md) - View and modify user settings.
- [**PhoneNumbers**](./phoneNumbers.md) - User's phone book.
- [**Plugins**](./plugins.md) - Enable or disable plugins.
- [**Profile**](./profile.md) - Get detail of the current user and information about his last logins.
- [**Promotions**](./promotions) - Get list of available promotions for the current user.
- [**Templates**](./templates.md) - List of payment templates for current user.

## General concepts

### Pagination

Resources that supports pagination implement `PaginatedListEnabled` interface (for example [AccountsResource](../netbanking/src/main/java/cz/csas/netbanking/accounts/AccountsResource.java)). If that is the case, you can (and should) pass an object with pagination properties to the list method. There is no SDK default pagination so if you do not pass pagination parameters then you get whatever the server decides so we strongly recommend you use pagination parameters.

```java

    // Set pagination page number and page size
    Pagination pagination = new Pagination(long pageNumber, long pageSize);

    // Put pagination parameters to accounts parameters
    AccountsParameters parameters = new AccountsParameters(pagination,
        SortParameter<AccountsSortableFields> sortBy,
        ProductType type);

    // Get paginated accounts list response
    Netbanking.getInstance().getNetbankingClient().getAccountsResource()
        .list(parameters, CallbackWebApi<AccountsListResponse> callback);

```

The response from this call contains pagination property and is defined by `PaginatedListResponse`.

On this response you can call nextPage() function which returns Callback with a next page results.

```java

    // Paginated accounts call
    Pagination pagination = new Pagination(long pageNumber, long pageSize);
    AccountsParameters parameters = new AccountsParameters(pagination,
        SortParameter<AccountsSortableFields> sortBy,
        ProductType type);

    Netbanking.getInstance().getNetbankingClient().getAccountsResource()
        .list(parameters, new CallbackWebApi<AccountsListResponse>() {
                  @Override
                  public void success(AccountsListResponse accountsListResponse) {
                      mAccountsListResponse = accountsListResponse;
                  }

                  @Override
                  public void failure(CsSDKError error) {}
              });

    // Next page call with checking
    if(mAccountsListResponse.hasNextPage()){
        mAccountsListResponse.nextPage(CallbackWebApi<AccountsListResponse> callback);
    }

```

`PaginatedListResponse` allows to use more methods. See list of these methods below.

```java

    // Get number of actual page
    mAccountsListResponse.getPageNumber();

    // Get actual page size
    mAccountsListResponse.getPageSize();

    // Get total page count
    mAccountsListResponse.getPageCount();

    // Get next page number
    mAccountsListResponse.getNextPage();


```

### Sorting

Methods that support server side sorting take object with properties sort and order as a parameter. These methods parameters interfaces extend `Sortable` interface. Both sort and order parameters are optional but you obviously cannot use order parameter without using sort parameter. Available Sort values are dependent on individual API. Order can be `SortDirection.ASCENDING` for ascending which is also default or `SortDirection.DESCENDING` for descending. See the accounts sorting example below.

```java

    // Use predefined sortable fields
    SortParameter sort = Sort.by(AccountsSortableFields.IBAN, SortDirection.ASCENDING)
        .thenBy(AccountsSortableFields.BALANCE, SortDirection.DESCENDING);

    // Use your own accounts sortable field
    SortParameter sort = Sort.by(AccountsSortableFields.BALANCE,SortDirection.ASCENDING)
        .thenBy(AccountsSortableFields.other("MyCustomField"),SortDirection.DESCENDING);

    // Pass sort parameters to accounts parameters
    AccountsParameters parameters = new AccountsParameters(Pagination pagination,
        sort,
        ProductType productType);

    // Get sorted accounts list response
    Netbanking.getInstance().getNetbankingClient().getAccountsResource()
        .list(parameters, CallbackWebApi<AccountsListResponse> callback);

```


### Signing

Most of the write operations (such as creating payment order or modifying user's settings) done through Netbanking SDK need to be signed. See **[signing guide](./signing.md)** to learn more about signing.

## Demo
Check out the [demo application](https://github.com/Ceskasporitelna/csas-sdk-demo-droid) for usage demonstration.

## Further documentation
Please see the documented [public API of the NetbankingSDK](../netbanking/src/main/java/cz/csas/netbanking/) for detailed description of the functionalities provided by this SDK.

This SDK communicates with Netbanking API. You can have a look at its [documentation](http://docs.ext0csasnetbanking3.apiary.io/#).

